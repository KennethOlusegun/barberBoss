<ion-header>
  <ion-toolbar color="primary">
    <ion-title>Dashboard</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div class="dashboard-content">
    <div *ngIf="loading" class="loading-container">
      <ion-spinner name="crescent" color="primary"></ion-spinner>
      <p>Carregando dados...</p>
    </div>

    <div *ngIf="error && !loading" class="error-container">
      <ion-text color="danger">
        <h2>Erro</h2>
        <p>{{ error }}</p>
      </ion-text>
    </div>

    <div *ngIf="!loading && !error">
      <ion-card>
        <ion-card-header>
          <ion-card-title>Acesso R치pido</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <div class="acesso-rapido-btns">
            <ion-button fill="solid" (click)="irParaClients()">
              <!-- 游댠 REMOVIDO: ion-icon problem치tico -->
              <mat-icon slot="start">people</mat-icon>
              Clientes
            </ion-button>
            <ion-button fill="solid" (click)="irParaServices()">
              <mat-icon slot="start">content_cut</mat-icon>
              Servi칞os
            </ion-button>
            <ion-button fill="solid" (click)="irParaFinance()">
              <mat-icon slot="start">payments</mat-icon>
              Financeiro
            </ion-button>
            <ion-button fill="solid" (click)="irParaProfile()">
              <mat-icon slot="start">account_circle</mat-icon>
              Perfil
            </ion-button>
          </div>
        </ion-card-content>
      </ion-card>

      <ion-card>
        <ion-card-header>
          <ion-card-title>Resumo de Agendamentos</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <div class="resumo-grid">
            <div class="resumo-item">
              <h3>{{ agendamentosResumo.total }}</h3>
              <p>Total</p>
            </div>
            <div class="resumo-item">
              <h3>{{ agendamentosResumo.proximos }}</h3>
              <p>Pr칩ximos</p>
            </div>
            <div class="resumo-item">
              <h3>{{ agendamentosResumo.concluidos }}</h3>
              <p>Conclu칤dos</p>
            </div>
          </div>
        </ion-card-content>

        <div
          style="
            display: flex;
            justify-content: center;
            margin-bottom: 16px;
            gap: 12px;
            flex-wrap: wrap;
          "
        >
          <ion-button
            size="small"
            fill="solid"
            color="primary"
            (click)="novoAgendamento()"
          >
            <mat-icon slot="start">add_circle</mat-icon>
            Novo Agendamento
          </ion-button>

          <ion-button
            *ngIf="perfil.role === 'ADMIN'"
            size="small"
            fill="outline"
            color="secondary"
            (click)="irParaAdmin()"
          >
            <mat-icon slot="start">settings</mat-icon>
            Painel Admin
          </ion-button>
        </div>
      </ion-card>

      <h2>Meus Agendamentos</h2>

      <div *ngIf="agendamentos.length === 0" class="empty-state">
        <p>Nenhum agendamento encontrado</p>
      </div>

      <ion-item-sliding *ngFor="let ag of agendamentos">
        <ion-item-options side="start">
          <ion-item-option
            color="success"
            (click)="concluirAgendamento(ag)"
            *ngIf="ag.status !== 'COMPLETED'"
          >
            <mat-icon slot="icon-only">check_circle</mat-icon>
            Concluir
          </ion-item-option>
        </ion-item-options>
        <ion-item [class.agendamento-card]="true">
          <ion-label>
            <div
              style="
                display: flex;
                align-items: center;
                justify-content: space-between;
              "
            >
              <div>
                <div style="font-weight: bold; font-size: 1.1em">
                  {{ ag.service?.name }}
                </div>
                <ion-badge
                  [color]="ag.status === 'CONFIRMED' ? 'success' : ag.status === 'COMPLETED' ? 'medium' : 'warning'"
                >
                  {{ ag.status }}
                </ion-badge>
              </div>
            </div>
            <div class="agendamento-info">
              <div class="info-row">
                <span class="label">Data:</span>
                <span class="value">{{ ag.startsAt | date: 'dd/MM/yyyy' }}</span>
              </div>
              <div class="info-row">
                <span class="label">Hor치rio:</span>
                <span class="value">{{ ag.startsAt | date: 'HH:mm' }} - {{ ag.endsAt | date: 'HH:mm' }}</span>
              </div>
              <div class="info-row" *ngIf="ag.service?.price">
                <span class="label">Pre칞o:</span>
                <span class="value">R$ {{ ag.service.price }}</span>
              </div>
              <div class="info-row" *ngIf="ag.service?.durationMin">
                <span class="label">Dura칞칚o:</span>
                <span class="value">{{ ag.service.durationMin }} min</span>
              </div>
            </div>
          </ion-label>
        </ion-item>
        <ion-item-options side="end">
          <ion-item-option
            color="danger"
            (click)="cancelarAgendamento(ag)"
            *ngIf="ag.status !== 'CANCELLED' && ag.status !== 'COMPLETED'"
          >
            <mat-icon slot="icon-only">cancel</mat-icon>
            Cancelar
          </ion-item-option>
        </ion-item-options>
      </ion-item-sliding>

      <h2>Meu Perfil</h2>

      <ion-card class="perfil-card">
        <ion-card-content>
          <div class="perfil-info">
            <div class="info-row">
              <span class="label">Nome:</span>
              <span class="value">{{ perfil.name }}</span>
            </div>
            <div class="info-row">
              <span class="label">Email:</span>
              <span class="value">{{ perfil.email }}</span>
            </div>
            <div class="info-row" *ngIf="perfil.phone">
              <span class="label">Telefone:</span>
              <span class="value">{{ perfil.phone }}</span>
            </div>
            <div class="info-row">
              <span class="label">Perfil:</span>
              <span class="value">{{ perfil.role }}</span>
            </div>
          </div>
        </ion-card-content>
      </ion-card>
    </div>
  </div>
</ion-content>
