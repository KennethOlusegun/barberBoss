<ion-header>
  <ion-toolbar color="primary">
    <ion-title>Dashboard</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div class="dashboard-content">
    <!-- LOADING -->
    <div *ngIf="loading" class="loading-container">
      <ion-spinner name="crescent" color="primary"></ion-spinner>
      <p>Carregando dados...</p>
    </div>

    <!-- ERROR -->
    <div *ngIf="error && !loading" class="error-container">
      <ion-text color="danger">
        <h2>Erro</h2>
        <p>{{ error }}</p>
      </ion-text>
    </div>

    <!-- CONTENT -->
    <div *ngIf="!loading && !error">
      <!-- ATALHOS PARA PÁGINAS DO BARBEIRO -->
      <ion-card>
        <ion-card-header>
          <ion-card-title>Acesso Rápido</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <div class="acesso-rapido-btns">
            <ion-button fill="solid" (click)="irParaClients()">
              <ion-icon name="people-outline" slot="start"></ion-icon>
              Clientes
            </ion-button>
            <ion-button fill="solid" (click)="irParaServices()">
              <ion-icon name="cut-outline" slot="start"></ion-icon>
              Serviços
            </ion-button>
            <ion-button fill="solid" (click)="irParaFinance()">
              <ion-icon name="cash-outline" slot="start"></ion-icon>
              Financeiro
            </ion-button>
            <ion-button fill="solid" (click)="irParaProfile()">
              <ion-icon name="person-circle-outline" slot="start"></ion-icon>
              Perfil
            </ion-button>
          </div>
        </ion-card-content>
      </ion-card>

      <!-- RESUMO DE AGENDAMENTOS -->
      <ion-card>
        <ion-card-header>
          <ion-card-title>Resumo de Agendamentos</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <div class="resumo-grid">
            <div class="resumo-item">
              <h3>{{ agendamentosResumo.total }}</h3>
              <p>Total</p>
            </div>
            <div class="resumo-item">
              <h3>{{ agendamentosResumo.proximos }}</h3>
              <p>Próximos</p>
            </div>
            <div class="resumo-item">
              <h3>{{ agendamentosResumo.concluidos }}</h3>
              <p>Concluídos</p>
            </div>
          </div>
        </ion-card-content>

        <div
          style="
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            gap: 8px;
            flex-wrap: wrap;
          "
        >
          <ion-button
            size="small"
            fill="solid"
            color="primary"
            (click)="novoAgendamento()"
          >
            <ion-icon name="add-circle-outline" slot="start"></ion-icon>
            Novo Agendamento
          </ion-button>
          <ion-button
            *ngIf="perfil.role === 'ADMIN'"
            size="small"
            fill="outline"
            color="secondary"
            (click)="irParaAdmin()"
          >
            <ion-icon name="settings-outline" slot="start"></ion-icon>
            Painel Admin
          </ion-button>
          <ion-button
            size="small"
            fill="outline"
            color="danger"
            (click)="logout()"
          >
            <ion-icon name="log-out-outline" slot="start"></ion-icon>
            Sair
          </ion-button>
        </div>
      </ion-card>

      <!-- LISTA DE AGENDAMENTOS -->
      <h2>Meus Agendamentos</h2>

      <div *ngIf="agendamentos.length === 0" class="empty-state">
        <p>Nenhum agendamento encontrado</p>
      </div>

      <ion-item-sliding *ngFor="let ag of agendamentos">
        <ion-item-options side="start">
          <ion-item-option
            color="success"
            (click)="concluirAgendamento(ag)"
            *ngIf="ag.status !== 'COMPLETED'"
          >
            <ion-icon name="checkmark-done-outline" slot="icon-only"></ion-icon>
            Concluir
          </ion-item-option>
        </ion-item-options>
        <ion-item [class.agendamento-card]="true">
          <ion-label>
            <div
              style="
                display: flex;
                align-items: center;
                justify-content: space-between;
              "
            >
              <div>
                <div style="font-weight: bold; font-size: 1.1em">
                  {{ ag.service?.name }}
                </div>
                <ion-badge
                  [color]="ag.status === 'CONFIRMED' ? 'success' : ag.status === 'COMPLETED' ? 'medium' : 'warning'"
                >
                  {{ ag.status }}
                </ion-badge>
              </div>
            </div>
            <div class="agendamento-info">
              <div class="info-row">
                <span class="label">Data:</span>
                <span class="value"
                  >{{ ag.startsAt | date: 'dd/MM/yyyy' }}</span
                >
              </div>
              <div class="info-row">
                <span class="label">Horário:</span>
                <span class="value"
                  >{{ ag.startsAt | date: 'HH:mm' }} - {{ ag.endsAt | date:
                  'HH:mm' }}</span
                >
              </div>
              <div class="info-row" *ngIf="ag.service?.price">
                <span class="label">Preço:</span>
                <span class="value">R$ {{ ag.service.price }}</span>
              </div>
              <div class="info-row" *ngIf="ag.service?.durationMin">
                <span class="label">Duração:</span>
                <span class="value">{{ ag.service.durationMin }} min</span>
              </div>
            </div>
          </ion-label>
        </ion-item>
        <ion-item-options side="end">
          <ion-item-option
            color="danger"
            (click)="cancelarAgendamento(ag)"
            *ngIf="ag.status !== 'CANCELLED' && ag.status !== 'COMPLETED'"
          >
            <ion-icon name="close-outline" slot="icon-only"></ion-icon>
            Cancelar
          </ion-item-option>
        </ion-item-options>
      </ion-item-sliding>

      <!-- PERFIL -->
      <h2>Meu Perfil</h2>

      <ion-card class="perfil-card">
        <ion-card-content>
          <div class="perfil-info">
            <div class="info-row">
              <span class="label">Nome:</span>
              <span class="value">{{ perfil.name }}</span>
            </div>
            <div class="info-row">
              <span class="label">Email:</span>
              <span class="value">{{ perfil.email }}</span>
            </div>
            <div class="info-row" *ngIf="perfil.phone">
              <span class="label">Telefone:</span>
              <span class="value">{{ perfil.phone }}</span>
            </div>
            <div class="info-row">
              <span class="label">Perfil:</span>
              <span class="value">{{ perfil.role }}</span>
            </div>
          </div>
        </ion-card-content>
      </ion-card>

      <div style="display: flex; justify-content: center; margin-top: 24px">
        <ion-button expand="block" color="danger" routerLink="/auth/logout">
          <ion-icon name="log-out-outline" slot="start"></ion-icon>
          Sair da Conta
        </ion-button>
      </div>
    </div>
  </div>
</ion-content>
